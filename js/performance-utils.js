(()=>{var r=class{constructor(e,t,s){this.pdfDocument=e,this.pdfjsLib=t,this.renderCallback=s,this.visiblePages=new Set,this.renderQueue=[],this.isRendering=!1,this.renderedPages=new Set,this.canvasPool=[],this.maxCanvasPoolSize=20,this.observer=null,this.setupIntersectionObserver()}setupIntersectionObserver(){this.observer=new IntersectionObserver(e=>{e.forEach(t=>{let s=parseInt(t.target.getAttribute("data-page"));t.isIntersecting?(this.visiblePages.add(s),this.queuePageRender(s)):this.visiblePages.delete(s)})},{root:document.getElementById("pdf-container"),rootMargin:"200px 0px",threshold:.1})}observePages(){document.querySelectorAll(".page-container").forEach(t=>{this.observer.observe(t)})}async queuePageRender(e){this.renderQueue.includes(e)||(this.renderQueue.push(e),this.isRendering||this.processRenderQueue())}async processRenderQueue(){if(this.renderQueue.length===0){this.isRendering=!1;return}this.isRendering=!0;let e=this.renderQueue.shift();if(this.visiblePages.has(e)&&this.renderCallback)try{await this.renderCallback(e),this.renderedPages.add(e)}catch(t){console.error(`Error rendering page ${e}:`,t)}requestAnimationFrame(()=>this.processRenderQueue())}resetRenderStatus(){this.renderedPages.clear(),this.renderQueue=[]}getCanvas(){return this.canvasPool.length>0?this.canvasPool.pop():document.createElement("canvas")}recycleCanvas(e){if(e)if(this.canvasPool.length<this.maxCanvasPoolSize){let t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.setTransform(1,0,0,1,0,0),this.canvasPool.push(e)}else e.width=1,e.height=1,e.remove()}optimizeCanvasRendering(e){let t=e.getContext("2d",{alpha:!0,desynchronized:!0});return e.style.transform="translateZ(0)",e.style.backfaceVisibility="hidden",t}cleanupResources(){this.observer&&this.observer.disconnect(),this.visiblePages.clear(),this.renderedPages.clear(),this.renderQueue=[],this.canvasPool=[]}};})();
