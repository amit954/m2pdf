/*
 * Copyright Â© 2023 Netas Ltd., Switzerland.
 * @author  Lukas Buchs, lukas.buchs@netas.ch
 * @license MIT
 * @date    2023-02-17
 */
import{MultiPartParser}from"./MultiPartParser.js";export class EmlReader{#t=null;constructor(t){this.#t=new MultiPartParser(t)}getDate(){let t=this.#t.getHeader("date");return t?new Date(t):null}getSubject(){return this.#t.getHeader("subject",!0,!0)}getFrom(){return this.#t.getHeader("from",!0,!0)}getBcc(){return this.#t.getHeader("bcc",!0,!0)}getCc(){return this.#t.getHeader("cc",!0,!0)}getTo(){return this.#t.getHeader("to",!0,!0)}getReplyTo(){return this.#t.getHeader("reply-to",!0,!0)}getType(){return this.#t.getHeader("received")?"received":"sent"}getHeader(t,e=!1,r=!1){return this.#t.getHeader(t,e,r)}getAttachments(){let t=[],e=this.#t.getPartByContentType("multipart","mixed");if(e)for(const r of e.getMultiParts())r.isAttachment&&t.push({filename:r.getFilename(),contentType:r.contentType,content:r.getBody(),filesize:r.getBody().byteLength});else{const e=this.#t.getPartByContentType("application","octet-stream");e&&e.getFilename()&&t.push({filename:e.getFilename(),contentType:e.contentType,content:e.getBody(),filesize:e.getBody().byteLength})}return t}getMessageText(){let t=this.#t.getPartByContentType("text","plain");if(t&&!t.isAttachment)return t.getBody();let e=this.#t.getPartByContentType("text","html");if(e&&!e.isAttachment){let t=e.getBody(),r=t.indexOf("<body");-1!==r&&(t=t.substring(r)),t=t.replace(/<style[\s\w\W]+<\/style>/g,"");let a=document.createElement("div");return a.innerHTML=t,a.innerText.replace(/\r?\n\s+\r?\n/g,"\n\n").trim()}return null}getMessageHtml(){let t=this.#t.getPartByContentType("text","html");if(t&&!t.isAttachment)return t.getBody();let e=this.#t.getPartByContentType("text","plain");return e&&!e.isAttachment?e.getBody().replace(/\r?\n/g,"<br />"):null}}