(()=>{var E=class{constructor(){}createTextAnnotation(n,t,r,u,m){let s=n.querySelector(`[data-id="${t.id}"]`);s&&s.remove();let e=document.createElement("div");e.className="text-annotation",e.setAttribute("data-id",t.id);let d=(t.fontSize||16)*u;e.style.left=`${t.x}px`,e.style.top=`${t.y}px`,e.style.fontSize=`${d}px`,e.style.lineHeight="1.2";let l=document.createElement("div");l.className="text-content",l.innerText=t.text,l.style.whiteSpace="pre",e.appendChild(l);let o=document.createElement("button");o.className="delete-btn",o.innerHTML='<i class="bi bi-x"></i>',o.onclick=p=>{p.stopPropagation();let c=m.modifications.get(r),a=c.findIndex(v=>v.id===t.id);a>-1&&c.splice(a,1),e.remove()},e.appendChild(o);let i=document.createElement("div");i.className="resize-handle",e.appendChild(i),n.appendChild(e),this.setupInteractions(e,l,t,u)}setupInteractions(n,t,r,u){n.onmousedown=s=>{if(s.target.classList.contains("resize-handle")||s.target.classList.contains("delete-btn")||t.isContentEditable)return;s.preventDefault();let e=s.clientX,d=s.clientY,l=parseFloat(n.style.left),o=parseFloat(n.style.top),i=c=>{let a=(c.clientX-e)/u,v=(c.clientY-d)/u,x=l+(c.clientX-e),y=o+(c.clientY-d);n.style.left=`${x}px`,n.style.top=`${y}px`,r.x=x,r.y=y},p=()=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",p)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",p)};let m=n.querySelector(".resize-handle");m.onmousedown=s=>{s.stopPropagation(),s.preventDefault();let e=s.clientY,d=r.fontSize||16,l=i=>{let c=1+(i.clientY-e)/200,a=Math.max(8,d*c);a=Math.min(100,a),r.fontSize=a,n.style.fontSize=`${a*u}px`},o=()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",o)},n.ondblclick=s=>{s.stopPropagation(),t.contentEditable=!0,t.focus(),n.classList.add("editing");let e=document.createRange();e.selectNodeContents(t);let d=window.getSelection();d.removeAllRanges(),d.addRange(e);let l=()=>{t.contentEditable=!1,n.classList.remove("editing"),r.text=t.innerText,window.getSelection().removeAllRanges()};t.onblur=l,t.onkeydown=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),t.blur())}}}};})();
