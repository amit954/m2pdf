(()=>{var w=class{constructor(){this.imageAnnotations=new Map}createImageAnnotation(t,e,l,o,a){let d=t.querySelector(`[data-id="${e.id}"]`);d&&d.remove();let s=document.createElement("div");s.className="image-annotation",s.setAttribute("data-id",e.id),s.style.left=`${e.x}px`,s.style.top=`${e.y}px`,s.style.width=`${e.width}px`,s.style.height=`${e.height}px`,this.setupImageElements(s,e,a,l),this.setupImageInteractions(s,e,l,o),t.appendChild(s)}setupImageElements(t,e,l,o){let a=document.createElement("img");a.src=e.data,a.style.width="100%",a.style.height="100%",e.noBackground=e.noBackground||!1,e.threshold=e.threshold||240,e.noBackground&&(a.classList.add("transparent-bg"),t.classList.add("show-threshold"),this.removeBackground(a,e)),t.appendChild(a);let d=document.createElement("div");d.className="threshold-slider-container";let s=document.createElement("input");s.type="range",s.className="threshold-slider",s.min="0",s.max="255",s.value=e.threshold,s.style.display=e.noBackground?"block":"none";let r;s.addEventListener("mousedown",c=>c.stopPropagation()),s.oninput=c=>{c.stopPropagation(),e.threshold=parseInt(c.target.value),r&&clearTimeout(r),r=setTimeout(()=>{this.removeBackground(a,e)},50)},d.appendChild(s),t.appendChild(d);let n=document.createElement("div");n.className="resize-handle",t.appendChild(n);let h=document.createElement("button");h.className="bg-toggle-btn"+(e.noBackground?" active":""),h.textContent="B",h.title="Toggle Background",h.onclick=async c=>{c.stopPropagation(),e.noBackground=!e.noBackground,e.noBackground?(h.classList.add("active"),t.classList.add("show-threshold"),s.style.display="block",await this.removeBackground(a,e)):(h.classList.remove("active"),t.classList.remove("show-threshold"),s.style.display="none",a.src=e.originalData||e.data,a.classList.remove("transparent-bg"))},t.appendChild(h);let p=document.createElement("button");p.className="delete-btn",p.textContent="\xD7",p.onclick=c=>{if(c.stopPropagation(),l){let u=l.modifications.get(o);if(u){let i=u.findIndex(y=>y.id===e.id);i>-1&&u.splice(i,1)}}t.remove()},t.appendChild(p)}async removeBackground(t,e){e.originalData||(e.originalData=e.data);let l=document.createElement("canvas"),o=l.getContext("2d");await new Promise(r=>{let n=new Image;n.onload=()=>{l.width=n.width,l.height=n.height,o.drawImage(n,0,0),r()},n.src=e.originalData});let a=o.getImageData(0,0,l.width,l.height),d=a.data;for(let r=0;r<d.length;r+=4){let n=d[r],h=d[r+1],p=d[r+2];(n+h+p)/3>e.threshold&&(d[r+3]=0)}o.putImageData(a,0,0);let s=l.toDataURL("image/png");t.src=s,e.data=s,t.classList.add("transparent-bg")}setupImageInteractions(t,e,l,o){this.setupDragHandling(t,e,o),this.setupResizeHandling(t,e,o)}setupDragHandling(t,e,l){let o=!1,a,d,s,r;t.addEventListener("mousedown",n=>{n.target.classList.contains("resize-handle")||n.target.classList.contains("delete-btn")||n.target.classList.contains("bg-toggle-btn")||n.target.closest(".threshold-slider-container")||(o=!0,a=n.clientX,d=n.clientY,s=parseFloat(t.style.left)||0,r=parseFloat(t.style.top)||0,t.style.cursor="move",n.preventDefault())}),document.addEventListener("mousemove",n=>{if(!o)return;let h=(n.clientX-a)/l,p=(n.clientY-d)/l,c=s+h,u=r+p;e.x=c,e.y=u,t.style.left=`${c}px`,t.style.top=`${u}px`}),document.addEventListener("mouseup",()=>{o&&(o=!1,t.style.cursor="default")})}setupResizeHandling(t,e,l){let o=t.querySelector(".resize-handle");o.onmousedown=a=>{a.stopPropagation(),a.preventDefault();let d=parseFloat(t.style.width),s=parseFloat(t.style.height),r=e.aspectRatio,n=a.clientX,h=a.clientY,p=u=>{let i=(u.clientX-n)/l,y=(u.clientY-h)/l,g,v;Math.abs(i)>Math.abs(y)?(g=d+i,v=g/r):(v=s+y,g=v*r);let m=20;g>m&&v>m&&(e.width=g,e.height=v,t.style.width=`${g}px`,t.style.height=`${v}px`)},c=()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",p),document.addEventListener("mouseup",c)}}};})();
